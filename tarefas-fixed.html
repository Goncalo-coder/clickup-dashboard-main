<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ¯ Tarefas da Semana</title>

<style>
body{font-family:Arial,sans-serif;background:#f7f8fa;padding:20px}
.container{max-width:1200px;margin:auto}
.card{background:white;padding:15px;margin:10px 0;border-radius:6px}
.btn{padding:6px 12px;background:#333;color:white;border:none;border-radius:4px;cursor:pointer}
</style>
</head>

<body>

<button class="btn" onclick="openConfig()">âš™ï¸ Configurar</button>

<div class="container">
<h1>ğŸ¯ Tarefas da Semana</h1>
<p id="week"></p>

<div id="loading">A carregarâ€¦</div>
<div id="content"></div>
<div id="error" style="color:red"></div>
</div>

<div id="config" style="display:none">
<input id="token" placeholder="pk_..." type="password">
<button onclick="save()">Guardar</button>
</div>

<script>

const TEAM_ID="90152320567";

function openConfig(){
 document.getElementById("config").style.display="block";
}

function save(){
 localStorage.setItem("clickup_api_token",document.getElementById("token").value);
 location.reload();
}

function getWeek(){
 const d=new Date();
 const m=new Date(d);
 m.setDate(d.getDate()-d.getDay()+1);
 const s=new Date(m);
 s.setDate(m.getDate()+6);

 return{
  start:m.toISOString().split("T")[0],
  end:s.toISOString().split("T")[0]
 }
}

async function load(){

 const token=localStorage.getItem("clickup_api_token");
 if(!token){openConfig();return;}

 const {start,end}=getWeek();

 document.getElementById("week").innerText=start+" â†’ "+end;

 try{

 const res=await fetch(
  `https://api.clickup.com/api/v2/team/${TEAM_ID}/task`,
 {
  method:"GET",
  headers:{Authorization:token}
 });

 if(!res.ok) throw new Error(res.status);

 const data=await res.json();

 const list=data.tasks.filter(t=>{
  if(!t.due_date) return false;
  const d=new Date(Number(t.due_date)).toISOString().split("T")[0];
  return d>=start && d<=end && !t.parent;
 });

 let html="";

 list.forEach(t=>{
  html+=`<div class="card">
   <b>${t.name}</b><br>
   Prazo: ${new Date(Number(t.due_date)).toLocaleDateString("pt-PT")}<br>
   <a href="${t.url}" target="_blank">Abrir</a>
  </div>`;
 });

 document.getElementById("content").innerHTML=html;
 document.getElementById("loading").style.display="none";

 }catch(e){
  document.getElementById("error").innerText="Erro API: "+e;
 }
}

load();
setInterval(load,300000);

</script>
</body>
</html>
